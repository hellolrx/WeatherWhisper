# WeatherWhisper (å¤©è¯­)

ä¸€ä¸ªåŸºäº Vue3 + FastAPI çš„æœ¬åœ°å¤©æ°”åº”ç”¨ï¼Œå¯¹æ¥å’Œé£å¤©æ°” APIï¼Œæ”¯æŒåŸå¸‚æœç´¢ã€å¤šå¤©æ°”ç±»å‹å±•ç¤ºã€æœ¬åœ°æ”¶è—ä¸æ™ºèƒ½ç©¿è¡£å»ºè®®ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- ğŸŒ¡ï¸ **å®æ—¶å¤©æ°”**: å½“å‰æ¸©åº¦ã€ä½“æ„Ÿæ¸©åº¦ã€é£å‘é£åŠ›ã€æ¹¿åº¦ç­‰è¯¦ç»†ä¿¡æ¯
- ğŸ“Š **å¤©æ°”é¢„æŠ¥**: 24å°æ—¶é€æ—¶é¢„æŠ¥ + 7å¤©è¶‹åŠ¿é¢„æŠ¥
- â­ **åŸå¸‚æ”¶è—**: æ”¯æŒå¤šåŸå¸‚ç®¡ç†ï¼ŒæŒ‰çœä»½åˆ†ç»„æ˜¾ç¤º
- ğŸ“§ **é‚®ä»¶æ¨é€**: ç«‹å³å‘é€ / å®šæ—¶æ¨é€å¤©æ°”åˆ°é‚®ç®±
- ğŸ¤– **AIç©¿è¡£å»ºè®®**: RAG + Gemini ç”Ÿæˆä¸ªæ€§åŒ–ç©¿æ­æ¨è
- ğŸ‘¤ **ç”¨æˆ·ç³»ç»Ÿ**: æ³¨å†Œç™»å½•ã€é‚®ç®±éªŒè¯ã€JWTè®¤è¯

## æŠ€æœ¯æ ˆ

### å‰ç«¯
- **æ¡†æ¶**: Vue 3 + TypeScript
- **æ„å»ºå·¥å…·**: Vite 5
- **çŠ¶æ€ç®¡ç†**: Pinia
- **è·¯ç”±**: Vue Router
- **HTTP**: Axios
- **æ ·å¼**: åŸç”Ÿ CSSï¼ˆæ¨¡å—åŒ–ï¼‰
- **å­˜å‚¨**: localStorageï¼ˆåŸå¸‚æ”¶è—ï¼‰

### åç«¯
- **æ¡†æ¶**: FastAPI
- **ASGI**: Uvicorn
- **HTTP Client**: HTTPXï¼ˆå¼‚æ­¥ï¼‰
- **ç¼“å­˜**: cachetoolsï¼ˆTTLCacheï¼‰
- **ç¯å¢ƒå˜é‡**: python-dotenv
- **æ•°æ®æ ¡éªŒ**: Pydantic

### AI & RAG
- **å‘é‡æ•°æ®åº“**: Pineconeï¼ˆçŸ¥è¯†åº“å­˜å‚¨ä¸æ£€ç´¢ï¼‰
- **åµŒå…¥æ¨¡å‹**: BAAI/bge-base-zh-v1.5ï¼ˆä¸­æ–‡è¯­ä¹‰å‘é‡ï¼‰
- **ç”Ÿæˆæ¨¡å‹**: Google Gemini 1.5 Flashï¼ˆç©¿è¡£å»ºè®®ç”Ÿæˆï¼‰
- **çŸ¥è¯†åº“**: æ—¶å°šç©¿æ­ä¸“ä¸šçŸ¥è¯†ï¼ˆCSVæ ¼å¼ï¼Œè‡ªåŠ¨å‘é‡åŒ–ï¼‰

### æ•°æ®åº“ & è®¤è¯
- **æ•°æ®åº“**: MySQL 8.0
- **ORM**: SQLAlchemyï¼ˆå¼‚æ­¥æ¨¡å¼ï¼‰
- **è®¤è¯**: JWT + bcryptï¼ˆè®¿é—®ä»¤ç‰Œ7å¤©ï¼Œåˆ·æ–°ä»¤ç‰Œ30å¤©ï¼‰
- **é‚®ä»¶æœåŠ¡**: QQé‚®ç®±SMTP + éªŒè¯ç ç³»ç»Ÿ

### å¼€å‘å·¥å…·
- **åŒ…ç®¡ç†**: npm (å‰ç«¯) + pip (åç«¯)
- **ç‰ˆæœ¬æ§åˆ¶**: Git
- **å†…ç½‘ç©¿é€**: ngrok
- **IDE**: cursor

## é¡¹ç›®ç»“æ„

### ğŸ—ï¸ æ¨¡å—åŒ–æ¶æ„è®¾è®¡

é¡¹ç›®é‡‡ç”¨ç»„ä»¶åŒ–ã€æ¨¡å—åŒ–çš„æ¶æ„è®¾è®¡ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ï¼š

```
WeatherWhisper/
â”œâ”€â”€ backend/                 # FastAPI åç«¯
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ routers/        # API è·¯ç”±å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ geo.py     # åŸå¸‚æŸ¥è¯¢æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ weather.py # å¤©æ°”æ•°æ®æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py    # è®¤è¯ç›¸å…³æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ favorites.py # æ”¶è—åŸå¸‚æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ notifications.py # é‚®ä»¶é€šçŸ¥æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ rag.py     # RAGç©¿è¡£å»ºè®®æ¥å£
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ qweather.py # ç¬¬ä¸‰æ–¹APIæœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_service.py # è®¤è¯æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ notification_service.py # é‚®ä»¶æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ rag_service.py # RAGæ£€ç´¢ä¸ç”ŸæˆæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ email_service.py # SMTPé‚®ä»¶å‘é€
â”‚   â”‚   â”œâ”€â”€ database/       # æ•°æ®åº“å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ models/    # SQLAlchemyæ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ connection.py # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â””â”€â”€ main.py        # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ rag/               # RAGç›¸å…³æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ knowledge_base.xlsx # ç©¿æ­çŸ¥è¯†åº“ï¼ˆExcelæ ¼å¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ ingest_pinecone.py # å‘é‡åŒ–å…¥åº“è„šæœ¬
â”‚   â”‚   â””â”€â”€ test_gemini.py # Gemini APIæµ‹è¯•
â”‚   â”œâ”€â”€ .env               # ç¯å¢ƒå˜é‡é…ç½®
â”‚   â””â”€â”€ requirements.txt   # Python ä¾èµ–
â””â”€â”€ frontend/              # Vue3 å‰ç«¯ï¼ˆæ¨¡å—åŒ–é‡æ„ï¼‰
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ components/     # ğŸ§© ç»„ä»¶åº“
    â”‚   â”‚   â”œâ”€â”€ search/     # æœç´¢ç›¸å…³ç»„ä»¶
    â”‚   â”‚   â”‚   â””â”€â”€ SearchBox.vue
    â”‚   â”‚   â”œâ”€â”€ favorites/  # æ”¶è—åŠŸèƒ½ç»„ä»¶
    â”‚   â”‚   â”‚   â””â”€â”€ FavoriteCities.vue
    â”‚   â”‚   â”œâ”€â”€ weather/    # å¤©æ°”æ˜¾ç¤ºç»„ä»¶
    â”‚   â”‚   â”‚   â”œâ”€â”€ CurrentWeather.vue
    â”‚   â”‚   â”‚   â”œâ”€â”€ HourlyForecast.vue
    â”‚   â”‚   â”‚   â””â”€â”€ DailyForecast.vue
    â”‚   â”‚   â”œâ”€â”€ auth/       # è®¤è¯ç›¸å…³ç»„ä»¶
    â”‚   â”‚   â”‚   â””â”€â”€ UserInfo.vue
    â”‚   â”‚   â””â”€â”€ modals/     # å¼¹çª—ç»„ä»¶
    â”‚   â”‚       â””â”€â”€ SendWeatherEmailModal.vue
    â”‚   â”œâ”€â”€ composables/    # ğŸ£ ç»„åˆå¼API
    â”‚   â”‚   â”œâ”€â”€ useWeatherApi.ts    # å¤©æ°”APIæœåŠ¡
    â”‚   â”‚   â”œâ”€â”€ useGeolocation.ts   # åœ°ç†ä½ç½®æœåŠ¡
    â”‚   â”‚   â”œâ”€â”€ useAuth.ts          # è®¤è¯æœåŠ¡
    â”‚   â”‚   â””â”€â”€ useNotificationApi.ts # é€šçŸ¥APIæœåŠ¡
    â”‚   â”œâ”€â”€ stores/         # ğŸ“¦ çŠ¶æ€ç®¡ç†
    â”‚   â”‚   â”œâ”€â”€ favorites.ts # æ”¶è—åŸå¸‚Store
    â”‚   â”‚   â””â”€â”€ auth.ts     # è®¤è¯çŠ¶æ€Store
    â”‚   â”œâ”€â”€ styles/         # ğŸ¨ æ ·å¼æ¨¡å—
    â”‚   â”‚   â”œâ”€â”€ global.css  # å…¨å±€æ ·å¼é‡ç½®
    â”‚   â”‚   â”œâ”€â”€ layout.css  # å¸ƒå±€æ ·å¼
    â”‚   â”‚   â””â”€â”€ cards.css   # å¡ç‰‡ç»„ä»¶æ ·å¼
    â”‚   â”œâ”€â”€ types/          # ğŸ“ ç±»å‹å®šä¹‰
    â”‚   â”‚   â””â”€â”€ weather.ts  # å¤©æ°”ç›¸å…³ç±»å‹
    â”‚   â”œâ”€â”€ utils/          # ğŸ”§ å·¥å…·å‡½æ•°
    â”‚   â”‚   â”œâ”€â”€ common.ts   # é€šç”¨å·¥å…·å‡½æ•°
    â”‚   â”‚   â”œâ”€â”€ http.ts     # HTTPè¯·æ±‚å°è£…
    â”‚   â”‚   â””â”€â”€ weather/    # å¤©æ°”ç›¸å…³å·¥å…·
    â”‚   â”‚       â””â”€â”€ icons.ts # å¤©æ°”å›¾æ ‡æ˜ å°„
    â”‚   â”œâ”€â”€ constants/      # ğŸ“‹ å¸¸é‡ç®¡ç†
    â”‚   â”‚   â””â”€â”€ index.ts    # åº”ç”¨é…ç½®å¸¸é‡
    â”‚   â”œâ”€â”€ views/          # ğŸ“„ é¡µé¢ç»„ä»¶
    â”‚   â”‚   â””â”€â”€ Dashboard.vue # ä¸»é¡µé¢ï¼ˆæ–°æ¶æ„ï¼‰
    â”‚   â””â”€â”€ main.ts         # åº”ç”¨å…¥å£
    â”‚   â”œâ”€â”€ router/
    â”‚   â””â”€â”€ App.vue
    â”œâ”€â”€ vite.config.ts     # Vite é…ç½®ï¼ˆå«ä»£ç†ï¼‰
    â””â”€â”€ package.json       # Node ä¾èµ–

### ğŸ¯ æ¶æ„è®¾è®¡åŸåˆ™

#### 1. **ç»„ä»¶åŒ–è®¾è®¡**
- **å•ä¸€èŒè´£**: æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šåŠŸèƒ½
- **å¯å¤ç”¨æ€§**: ç»„ä»¶è®¾è®¡è€ƒè™‘åœ¨ä¸åŒåœºæ™¯ä¸‹çš„å¤ç”¨
- **æ¾è€¦åˆ**: ç»„ä»¶é—´é€šè¿‡propså’Œeventsé€šä¿¡ï¼Œé¿å…ç›´æ¥ä¾èµ–

#### 2. **æ ·å¼æ¨¡å—åŒ–**
- **å…¨å±€æ ·å¼**: `styles/global.css` - é‡ç½®æ ·å¼å’ŒåŸºç¡€è®¾å®š
- **å¸ƒå±€æ ·å¼**: `styles/layout.css` - ç½‘æ ¼å¸ƒå±€å’Œå“åº”å¼è®¾è®¡
- **ç»„ä»¶æ ·å¼**: æ¯ä¸ªç»„ä»¶ä½¿ç”¨scopedæ ·å¼ï¼Œé¿å…æ ·å¼æ±¡æŸ“
- **æ ·å¼å¤ç”¨**: é€šç”¨å¡ç‰‡ã€æŒ‰é’®ç­‰åŸºç¡€æ ·å¼æå–ä¸ºCSSæ¨¡å—

#### 3. **ä¸šåŠ¡é€»è¾‘åˆ†å±‚**
- **Composables**: ä½¿ç”¨Vue3ç»„åˆå¼APIå°è£…å¯å¤ç”¨çš„ä¸šåŠ¡é€»è¾‘
- **APIæœåŠ¡å±‚**: `composables/useWeatherApi.ts` ç»Ÿä¸€ç®¡ç†APIè°ƒç”¨
- **å·¥å…·å‡½æ•°**: `utils/` ç›®å½•å­˜æ”¾çº¯å‡½æ•°å·¥å…·
- **ç±»å‹å®‰å…¨**: TypeScriptç±»å‹å®šä¹‰ç¡®ä¿æ•°æ®ç»“æ„ä¸€è‡´æ€§

#### 4. **çŠ¶æ€ç®¡ç†**
- **Storeæ¨¡å¼**: ä½¿ç”¨Piniaç®¡ç†å…¨å±€çŠ¶æ€ï¼ˆå¦‚æ”¶è—åŸå¸‚ï¼‰
- **å±€éƒ¨çŠ¶æ€**: ç»„ä»¶å†…éƒ¨çŠ¶æ€ä½¿ç”¨ref/reactive
- **æ•°æ®æŒä¹…åŒ–**: localStorageé›†æˆåœ¨Storeä¸­ï¼Œç»Ÿä¸€ç®¡ç†

#### 5. **å¯ç»´æŠ¤æ€§åŸåˆ™**
- **æ–‡ä»¶èŒè´£æ˜ç¡®**: æ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ç‰¹å®šåŠŸèƒ½
- **å‘½åè§„èŒƒ**: ç»„ä»¶ã€å‡½æ•°ã€å˜é‡ä½¿ç”¨è¯­ä¹‰åŒ–å‘½å
- **é…ç½®é›†ä¸­**: å¸¸é‡å’Œé…ç½®ç»Ÿä¸€ç®¡ç†åœ¨`constants/`
- **æ–‡æ¡£å®Œæ•´**: å…³é”®å‡½æ•°å’Œç»„ä»¶åŒ…å«TypeScriptç±»å‹æ³¨é‡Š

### ğŸš€ ä½¿ç”¨æ–°æ¶æ„çš„å¥½å¤„

1. **å¼€å‘æ•ˆç‡æå‡**: ç»„ä»¶åŒ–å¼€å‘ï¼ŒåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œå¹¶è¡Œå¼€å‘æ›´å®¹æ˜“
2. **ç»´æŠ¤æˆæœ¬é™ä½**: å•ä¸ªç»„ä»¶ä¿®æ”¹ä¸å½±å“å…¶ä»–éƒ¨åˆ†ï¼Œé™ä½å›å½’é£é™©
3. **ä»£ç å¤ç”¨æ€§**: ç»„ä»¶å¯åœ¨ä¸åŒé¡µé¢å¤ç”¨ï¼Œå‡å°‘é‡å¤ä»£ç 
4. **å›¢é˜Ÿåä½œ**: æ¸…æ™°çš„æ–‡ä»¶ç»“æ„å’ŒèŒè´£åˆ†å·¥ï¼Œä¾¿äºå¤šäººåä½œ
5. **æµ‹è¯•å‹å¥½**: æ¯ä¸ªç»„ä»¶å’Œå‡½æ•°éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•
6. **æ‰©å±•æ€§å¼º**: æ–°å¢åŠŸèƒ½åªéœ€æ·»åŠ æ–°ç»„ä»¶ï¼Œä¸éœ€ä¿®æ”¹ç°æœ‰ä»£ç 

### ğŸ’¡ **æ¶æ„è¿ç§»è¯´æ˜**

**é‡è¦æç¤ºï¼šé¡¹ç›®å·²å®Œæˆæ¶æ„é‡æ„ï¼** 

- âœ… **æ—§ç‰ˆæœ¬**: å•ä¸€ `Dashboard.vue` æ–‡ä»¶ï¼ˆå·²åˆ é™¤ï¼‰
- ğŸš€ **æ–°ç‰ˆæœ¬**: æ¨¡å—åŒ–ç»„ä»¶æ¶æ„ï¼ˆå½“å‰ä½¿ç”¨ï¼‰

å¦‚æœæ‚¨æ˜¯åä½œè€…ï¼Œè¯·æ³¨æ„ï¼š
1. é¡¹ç›®ç°åœ¨ä½¿ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œä»£ç æ›´æ¸…æ™°æ˜“ç»´æŠ¤
2. æ‰€æœ‰åŠŸèƒ½å·²æ‹†åˆ†ä¸ºç‹¬ç«‹ç»„ä»¶ï¼Œåœ¨ `src/components/` ç›®å½•
3. ä¸šåŠ¡é€»è¾‘æå–ä¸º `composables`ï¼Œæ ·å¼æ¨¡å—åŒ–ç®¡ç†
4. å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒä¸Šé¢çš„æ¶æ„è®¾è®¡åŸåˆ™

### ğŸ”§ **å¼€å‘å·¥ä½œæµ**

æ–°å¢åŠŸèƒ½æ—¶è¯·éµå¾ªä»¥ä¸‹æ¨¡å¼ï¼š
```bash
# 1. æ–°å¢ç»„ä»¶
src/components/åŠŸèƒ½æ¨¡å—/ComponentName.vue

# 2. æ–°å¢ä¸šåŠ¡é€»è¾‘
src/composables/useFeatureName.ts

# 3. æ–°å¢ç±»å‹å®šä¹‰
src/types/featureName.ts

# 4. æ–°å¢æ ·å¼æ¨¡å—ï¼ˆå¯é€‰ï¼‰
src/styles/featureName.css
```

## å¿«é€Ÿå¼€å§‹

### 1. åç«¯é…ç½®
```bash
# 1. åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
py -m venv backend\.venv
backend\.venv\Scripts\activate  # Windows
source backend/.venv/bin/activate  # Linux/Mac

# 2. å®‰è£…ä¾èµ–
pip install -r backend/requirements.txt

# 3. é…ç½® backend/.env
QWEATHER_API_KEY=ä½ çš„å’Œé£å¤©æ°”å¯†é’¥
QWEATHER_GEO=https://geoapi.qweather.com
QWEATHER_BASE=https://devapi.qweather.com
ALLOW_ORIGINS=http://localhost:5173,http://127.0.0.1:5173

# 4. å¯åŠ¨åç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
python -m uvicorn app.main:app --app-dir backend --host 127.0.0.1 --port 8000 --reload
```

### 2. å‰ç«¯é…ç½®
```bash
# 1. å®‰è£…ä¾èµ–
cd frontend
npm install

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev -- --host 0.0.0.0 --port 5173
```

### 3. éªŒè¯
1. æ‰“å¼€ `http://127.0.0.1:8000/api/health` æ£€æŸ¥åç«¯
2. è®¿é—® `http://localhost:5173` ä½¿ç”¨åº”ç”¨
3. åœ¨æœç´¢æ¡†è¾“å…¥"åŒ—äº¬"ï¼Œé€‰æ‹©ä¸‹æ‹‰é¡¹å³å¯çœ‹åˆ°å¤©æ°”ä¿¡æ¯

## API æ¥å£

### åç«¯ä»£ç†æ¥å£
- `GET /api/health` - å¥åº·æ£€æŸ¥
- `GET /api/geo?query=åŸå¸‚å` - åŸå¸‚æœç´¢
- `GET /api/weather/now?location=åŸå¸‚ID` - å®æ—¶å¤©æ°”
- `GET /api/weather/24h?location=åŸå¸‚ID` - 24å°æ—¶é¢„æŠ¥
- `GET /api/weather/7d?location=åŸå¸‚ID` - 7å¤©é¢„æŠ¥

### æ•°æ®ç¼“å­˜
- ä½¿ç”¨ TTLCache å¯¹å’Œé£å¤©æ°” API å“åº”åš 60 ç§’ç¼“å­˜
- ç¼“å­˜é”®ï¼šè¯·æ±‚URL + å‚æ•°çš„ç¨³å®šå­—ç¬¦ä¸²
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜

## å†…ç½‘ç©¿é€ï¼ˆå¯é€‰ï¼‰
```bash
# ä»…æš´éœ²å‰ç«¯ 5173 ç«¯å£ï¼ˆå·²é…ç½®ä»£ç†ï¼‰
ngrok http http://localhost:5173

# å¤åˆ¶ç”Ÿæˆçš„åŸŸååˆ†äº«å³å¯
# å½¢å¦‚ https://xxxx.ngrok-free.app
```

## å¼€å‘å»ºè®®
1. **ç¯å¢ƒå˜é‡**
   - ä¸¥æ ¼éµå®ˆ `.gitignore`ï¼Œä¸è¦æäº¤ `.env` æ–‡ä»¶
   - å‚è€ƒ `.env.example` é…ç½®æœ¬åœ°ç¯å¢ƒ

2. **API è°ƒç”¨**
   - ä½¿ç”¨å’Œé£å¤©æ°”å…è´¹ç‰ˆ APIï¼ˆdevapi/geoapiï¼‰
   - è‹¥ç”¨ä¸“å±åŸŸåï¼ˆ*.re.qweatherapi.comï¼‰ï¼Œéœ€æ”¹ç”¨ Bearer é‰´æƒ

3. **ç¼“å­˜ç­–ç•¥**
   - é»˜è®¤ 60 ç§’ TTL é€‚åˆå¤§å¤šæ•°åœºæ™¯
   - å¯åœ¨ `qweather.py` ä¸­è°ƒæ•´ç¼“å­˜å‚æ•°

4. **å‰ç«¯ä¼˜åŒ–**
   - æœç´¢é˜²æŠ–ï¼ˆå·²å®ç°ï¼‰
   - é”™è¯¯å‹å¥½æç¤º
   - å“åº”å¼è®¾è®¡
   - æ¨¡å—åŒ–CSSæ¶æ„

## å‰ç«¯è®¾è®¡è§„åˆ™

### CSSæ¶æ„åŸåˆ™
1. **æ¨¡å—åŒ–è®¾è®¡**
   - æ¯ä¸ªç»„ä»¶æ‹¥æœ‰ç‹¬ç«‹çš„CSSæ ·å¼
   - é¿å…ä½¿ç”¨ `!important` å¼ºåˆ¶è¦†ç›–
   - æ˜ç¡®çš„å‘½åè§„èŒƒï¼š`/* ç»„ä»¶åç§°æ ·å¼ - ç‹¬ç«‹æ¨¡å— */`

2. **æ ·å¼éš”ç¦»**
   ```css
   /* âœ… æ¨èï¼šç»„ä»¶ç‹¬ç«‹æ ·å¼ */
   .search-input {
     margin: 0;
     padding: clamp(1rem, 2.5vw, 1.5rem) clamp(1.5rem, 3vw, 2rem);
   }
   
   /* âŒ é¿å…ï¼šå…¨å±€å¼ºåˆ¶é‡ç½® */
   * {
     padding: 0 !important;
   }
   ```

3. **å“åº”å¼è®¾è®¡**
   - ä½¿ç”¨ `clamp()` å‡½æ•°å®ç°æµä½“æ’ç‰ˆ
   - ç§»åŠ¨ä¼˜å…ˆçš„å“åº”å¼æ–­ç‚¹
   - Grid + Flexbox æ··åˆå¸ƒå±€

### å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

#### 1. TypeScript æ‰¾ä¸åˆ°å·²åˆ é™¤æ–‡ä»¶é”™è¯¯
**é—®é¢˜ç—‡çŠ¶**ï¼š
```
æ‰¾ä¸åˆ°æ–‡ä»¶"d:/WeatherWhisper/frontend/src/components/HelloWorld.vue"ã€‚
ç¨‹åºåŒ…å«è¯¥æ–‡ä»¶æ˜¯å› ä¸º:
  é€šè¿‡åœ¨ "d:/WeatherWhisper/frontend/tsconfig.app.json" ä¸­çš„åŒ…å«æ¨¡å¼ "src/**/*.vue" åŒ¹é…
```

**é—®é¢˜åŸå› **ï¼šTypeScript ç¼–è¯‘å™¨ç¼“å­˜ä¸­ä¿ç•™äº†å¯¹å·²åˆ é™¤æ–‡ä»¶çš„å¼•ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ³•1ï¼šæ¸…ç† TypeScript æ„å»ºç¼“å­˜
cd frontend
Remove-Item -Path "node_modules/.tmp" -Recurse -Force -ErrorAction SilentlyContinue

# æ–¹æ³•2ï¼šå¦‚æœé—®é¢˜ä»å­˜åœ¨ï¼Œé‡å¯ TypeScript è¯­è¨€æœåŠ¡
# åœ¨ VS Code/Cursor ä¸­ï¼š
# 1. æŒ‰ Ctrl+Shift+P æ‰“å¼€å‘½ä»¤é¢æ¿
# 2. è¾“å…¥ "TypeScript: Restart TS Server"
# 3. é€‰æ‹©å¹¶æ‰§è¡Œ

# æ–¹æ³•3ï¼šé‡æ–°æ„å»ºé¡¹ç›®
npm run build
```

**é¢„é˜²æªæ–½**ï¼š
- åˆ é™¤ç»„ä»¶æ–‡ä»¶ååŠæ—¶é‡å¯ç¼–è¾‘å™¨çš„ TypeScript æœåŠ¡
- å®šæœŸæ¸…ç†æ„å»ºç¼“å­˜ï¼Œç‰¹åˆ«æ˜¯é‡æ„å
- ä½¿ç”¨ `npm run build` éªŒè¯æ²¡æœ‰ TypeScript é”™è¯¯

#### 2. èƒŒæ™¯æ— æ³•å…¨å±é—®é¢˜
**é—®é¢˜**ï¼šé¡µé¢èƒŒæ™¯å‡ºç°ç™½è¾¹ï¼Œæ— æ³•è¦†ç›–æ•´ä¸ªå±å¹•
```css
/* âŒ é—®é¢˜ä»£ç  */
.app {
  padding: 2rem; /* å¯¼è‡´èƒŒæ™¯ç¼©å° */
  background-size: 100% 100%; /* å›ºå®šå°ºå¯¸ï¼Œæ»šåŠ¨æ—¶ä¸¢å¤± */
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```css
/* âœ… è§£å†³æ–¹æ¡ˆ */
html, body {
  margin: 0;
  padding: 0;
}

body {
  background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #6c5ce7 100%);
  background-attachment: fixed; /* å…³é”®ï¼šå›ºå®šèƒŒæ™¯ */
  background-size: cover; /* è¦†ç›–æ•´ä¸ªè§†å£ */
  min-height: 100vh;
}

.container {
  margin: 0 auto;
  padding: clamp(0.5rem, 1vw, 1.5rem); /* å®¹å™¨å†…è¾¹è· */
}
```

#### 2. å†…å®¹æº¢å‡ºå’Œå¸ƒå±€æ··ä¹±
**é—®é¢˜**ï¼šå¡ç‰‡å†…å®¹æº¢å‡ºå®¹å™¨ï¼Œæ¨ªå‘æ»šåŠ¨å¤±æ•ˆ
```css
/* âŒ é—®é¢˜ä»£ç  */
.hour-cards {
  display: flex;
  flex-wrap: wrap; /* å¯¼è‡´æ¢è¡Œè€Œéæ»šåŠ¨ */
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```css
/* âœ… è§£å†³æ–¹æ¡ˆ */
.hourly-forecast-module {
  display: grid;
  grid-template-columns: repeat(6, 1fr); /* æ¡Œé¢ç«¯ï¼š6åˆ—ç½‘æ ¼ */
  gap: clamp(1rem, 2vw, 1.5rem);
  justify-items: center;
}

@media (max-width: 767px) {
  .hourly-forecast-module {
    grid-template-columns: repeat(4, 1fr); /* ç§»åŠ¨ç«¯ï¼š4åˆ—ç½‘æ ¼ */
  }
}
```

#### 3. æ–‡å­—è´´è¾¹é—®é¢˜
**é—®é¢˜**ï¼šç»„ä»¶å†…æ–‡å­—ç´§è´´è¾¹æ¡†ï¼Œè§†è§‰æ•ˆæœå·®
```css
/* âŒ é—®é¢˜ä»£ç  */
.card {
  padding: 0; /* æ— å†…è¾¹è· */
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```css
/* âœ… è§£å†³æ–¹æ¡ˆï¼šåˆ†ç»„ä»¶ç‹¬ç«‹è®¾ç½® */
.search-input {
  padding: clamp(1rem, 2.5vw, 1.5rem) clamp(1.5rem, 3vw, 2rem);
}

.favorite-card {
  padding: 1rem 1.25rem;
}

.hour-card {
  padding: 1.25rem 1rem;
}
```

#### 4. ä¸‹æ‹‰æ¡†é®æŒ¡é—®é¢˜
**é—®é¢˜**ï¼šæœç´¢ä¸‹æ‹‰æ¡†ä¸æ”¶è—åˆ—è¡¨é‡å 
**è§£å†³æ–¹æ¡ˆ**ï¼š
```css
/* ä¸‹æ‹‰æ¡†ä½¿ç”¨ç»å¯¹å®šä½ */
.options-dropdown {
  position: absolute;
  top: calc(100% + 8px);
  z-index: 2000;
}

/* æ”¶è—æ¡†åŠ¨æ€æ¨ç§» */
.favorites-section.pushed-down {
  margin-top: 280px;
  transition: margin-top 0.3s ease;
}
```

### å¼€å‘æœ€ä½³å®è·µ
1. **CSSä¼˜å…ˆçº§ç®¡ç†**
   - é¿å…æ·±å±‚åµŒå¥—é€‰æ‹©å™¨
   - ä½¿ç”¨ç±»é€‰æ‹©å™¨è€Œéæ ‡ç­¾é€‰æ‹©å™¨
   - åªåœ¨å¿…è¦æ—¶ä½¿ç”¨ `!important`

2. **å¸ƒå±€è°ƒè¯•æŠ€å·§**
   - ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·å®æ—¶è°ƒè¯•
   - é€šè¿‡ `outline: 1px solid red` å¿«é€Ÿå®šä½é—®é¢˜
   - æ£€æŸ¥ `box-sizing: border-box` è®¾ç½®

3. **å“åº”å¼æµ‹è¯•**
   - æµ‹è¯•å¤šç§å±å¹•å°ºå¯¸
   - éªŒè¯ `clamp()` å‡½æ•°çš„æœ€å°/æœ€å¤§å€¼
   - ç¡®ä¿è§¦æ‘¸è®¾å¤‡çš„äº¤äº’å‹å¥½æ€§

## Git æäº¤ä¸æ¨é€æµç¨‹

### æ­£ç¡®çš„æäº¤æ­¥éª¤

#### 1. æ£€æŸ¥æ–‡ä»¶çŠ¶æ€
```bash
git status
```
æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•çš„ä¿®æ”¹çŠ¶æ€ï¼Œäº†è§£å“ªäº›æ–‡ä»¶å·²ä¿®æ”¹ã€æ–°å¢æˆ–åˆ é™¤ã€‚

#### 2. ç†è§£ .gitignore è§„åˆ™
åœ¨æäº¤å‰ï¼ŒåŠ¡å¿…äº†è§£ `.gitignore` æ–‡ä»¶æ’é™¤çš„å†…å®¹ï¼š

**é¡¹ç›®æ ¹ç›®å½• .gitignore æ’é™¤ï¼š**
- `backend/.venv/` - Python è™šæ‹Ÿç¯å¢ƒ
- `__pycache__/`, `*.pyc` - Python ç¼–è¯‘æ–‡ä»¶
- `frontend/node_modules/` - Node.js ä¾èµ–åŒ…
- `backend/.env`, `.env` - ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
- `frontend/dist/` - æ„å»ºè¾“å‡ºç›®å½•
- `.idea/`, `.vscode/` - IDE é…ç½®æ–‡ä»¶
- å„ç§æ—¥å¿—æ–‡ä»¶å’Œç³»ç»Ÿæ–‡ä»¶

**frontend/.gitignore è¡¥å……æ’é™¤ï¼š**
- `logs`, `*.log` - æ—¥å¿—æ–‡ä»¶
- `node_modules`, `dist` - ä¾èµ–å’Œæ„å»ºæ–‡ä»¶
- ç¼–è¾‘å™¨ä¸´æ—¶æ–‡ä»¶


#### 4. ç¡®è®¤æš‚å­˜åŒºå†…å®¹
```bash
git status
```
æ£€æŸ¥ "Changes to be committed" éƒ¨åˆ†ï¼Œç¡®ä¿åªåŒ…å«åº”è¯¥æäº¤çš„æ–‡ä»¶ã€‚

#### 5. åˆ›å»ºæäº¤
```bash
git commit -m "feat: æ›´æ–°å¤©æ°”åº”ç”¨åŠŸèƒ½å’Œå‰ç«¯ç»„ä»¶"
```
ä½¿ç”¨ç®€æ´æ˜ç¡®çš„æäº¤ä¿¡æ¯ï¼Œéµå¾ªçº¦å®šå¼æäº¤æ ¼å¼ã€‚

#### 6. æ¨é€åˆ°è¿œç¨‹ä»“åº“
```bash
# æ£€æŸ¥è¿œç¨‹ä»“åº“é…ç½®
git remote -v

# æ¨é€åˆ° GitHub
git push origin main
```

#### 7. éªŒè¯æ¨é€ç»“æœ
```bash
git status
# åº”æ˜¾ç¤ºï¼šYour branch is up to date with 'origin/main'
```

### æäº¤ä¿¡æ¯è§„èŒƒ

é‡‡ç”¨çº¦å®šå¼æäº¤æ ¼å¼ï¼š
- `feat:` - æ–°åŠŸèƒ½
- `fix:` - ä¿®å¤bug
- `docs:` - æ–‡æ¡£æ›´æ–°
- `style:` - ä»£ç æ ¼å¼è°ƒæ•´
- `refactor:` - é‡æ„ä»£ç 
- `test:` - æµ‹è¯•ç›¸å…³
- `chore:` - æ„å»ºæˆ–è¾…åŠ©å·¥å…·å˜åŠ¨

### å¸¸è§é”™è¯¯é¿å…

1. **ä¸è¦æäº¤æ•æ„Ÿä¿¡æ¯**
   - ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆ`.env`ï¼‰
   - API å¯†é’¥å’Œé…ç½®

2. **ä¸è¦æäº¤ç”Ÿæˆæ–‡ä»¶**
   - `node_modules/` - ä¾èµ–åŒ…ç›®å½•
   - `dist/` - æ„å»ºè¾“å‡º
   - `__pycache__/` - Python ç¼“å­˜

3. **ä¸è¦æäº¤IDEé…ç½®**
   - `.idea/`, `.vscode/` - ç¼–è¾‘å™¨é…ç½®
   - ä¸´æ—¶æ–‡ä»¶å’Œç¼“å­˜

### æœ€ä½³å®è·µ

1. **å®šæœŸæäº¤**ï¼šå®Œæˆä¸€ä¸ªåŠŸèƒ½æ¨¡å—å°±æäº¤ä¸€æ¬¡
2. **åŸå­æäº¤**ï¼šæ¯æ¬¡æäº¤åªåŒ…å«ç›¸å…³çš„æ›´æ”¹
3. **æ¸…æ™°æè¿°**ï¼šæäº¤ä¿¡æ¯è¦èƒ½æ¸…æ¥šè¯´æ˜æœ¬æ¬¡æ›´æ”¹çš„å†…å®¹
4. **å…ˆæ‹‰åæ¨**ï¼šå¤šäººåä½œæ—¶å…ˆ `git pull` å† `git push`

## è®¸å¯è¯´æ˜
- æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ äº¤æµ
- è¯·éµå®ˆå’Œé£å¤©æ°”å¼€å‘è€…åè®®
- å›¾æ ‡ç‰ˆæƒå½’å’Œé£å¤©æ°”æ‰€æœ‰

---

## ğŸš¨ é—®é¢˜è§£å†³è®°å½•2025.8.11

æœ¬æ–‡æ¡£è®°å½•äº†é¡¹ç›®å¯åŠ¨è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸»è¦é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œä¾›åç»­å¼€å‘è€…å‚è€ƒã€‚

## ğŸ‰ ç™»å½•åŠŸèƒ½å¼€å‘å®Œæˆè®°å½• 2025.8.14

### åŠŸèƒ½æ¦‚è¿°
âœ… **ç”¨æˆ·æ³¨å†Œ**: é‚®ç®±+ç”¨æˆ·å+å¯†ç ï¼ˆ8ä½ä»¥ä¸Šï¼‰+ é‚®ç®±éªŒè¯ç éªŒè¯  
âœ… **ç”¨æˆ·ç™»å½•**: é‚®ç®±+å¯†ç +è®°ä½æˆ‘åŠŸèƒ½  
âœ… **è®¿å®¢æ¨¡å¼**: æ— éœ€æ³¨å†Œï¼Œç›´æ¥è¿›å…¥å¤©æ°”ä¸»é¡µ
âœ… **JWTè®¤è¯**: è®¿é—®ä»¤ç‰Œ7å¤©ï¼Œåˆ·æ–°ä»¤ç‰Œ30å¤©
âœ… **å®‰å…¨ç‰¹æ€§**: å¯†ç å“ˆå¸Œå­˜å‚¨ï¼Œé‚®ç®±éªŒè¯
âœ… **é‚®ç®±éªŒè¯**: QQé‚®ç®±SMTPæœåŠ¡ï¼Œ6ä½æ•°å­—éªŒè¯ç ï¼Œ10åˆ†é’Ÿæœ‰æ•ˆæœŸ âœ… **å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡**

### æŠ€æœ¯å®ç°
- **åç«¯**: FastAPI + SQLAlchemy + JWT + bcrypt + QQé‚®ç®±SMTP
- **å‰ç«¯**: Vue3 + TypeScript + Pinia + Vue Router
- **æ•°æ®åº“**: MySQL + å¤–é”®çº¦æŸ + çº§è”åˆ é™¤
- **è®¤è¯**: JWTä»¤ç‰Œ + æœ¬åœ°å­˜å‚¨ + è·¯ç”±å®ˆå«
- **é‚®ä»¶æœåŠ¡**: QQé‚®ç®±SMTP + éªŒè¯ç ç”Ÿæˆ + é‚®ä»¶æ¨¡æ¿

### é‚®ç®±éªŒè¯æµç¨‹ âœ… **å·²å®ç°**
1. **å‘é€éªŒè¯ç **: ç”¨æˆ·è¾“å…¥é‚®ç®±åç‚¹å‡»"å‘é€éªŒè¯ç " âœ…
2. **éªŒè¯ç ç”Ÿæˆ**: ç³»ç»Ÿç”Ÿæˆ6ä½æ•°å­—éªŒè¯ç ï¼Œæœ‰æ•ˆæœŸ10åˆ†é’Ÿ âœ…
3. **é‚®ä»¶å‘é€**: é€šè¿‡QQé‚®ç®±SMTPæœåŠ¡å‘é€éªŒè¯ç åˆ°ç”¨æˆ·é‚®ç®± âœ…
4. **éªŒè¯ç éªŒè¯**: ç”¨æˆ·è¾“å…¥éªŒè¯ç ï¼Œç³»ç»ŸéªŒè¯åå®Œæˆæ³¨å†Œ âœ…
5. **é˜²é‡å¤å‘é€**: 60ç§’å€’è®¡æ—¶ï¼Œé˜²æ­¢é¢‘ç¹å‘é€éªŒè¯ç  âœ…

### é‚®ç®±é…ç½®è¯´æ˜ âœ… **å·²é…ç½®å®Œæˆ**
é¡¹ç›®ä½¿ç”¨QQé‚®ç®±SMTPæœåŠ¡å‘é€éªŒè¯ç é‚®ä»¶ï¼Œé…ç½®å·²å®Œæˆï¼š

```bash
# åœ¨ backend/.env æ–‡ä»¶ä¸­å·²é…ç½®
SMTP_HOST=smtp.qq.com
SMTP_PORT=587
SMTP_USER=your_email@qq.com
SMTP_PASSWORD=your_smtp_password  # QQé‚®ç®±æˆæƒç ï¼Œéç™»å½•å¯†ç 
SMTP_USE_TLS=true
```

**è·å–QQé‚®ç®±æˆæƒç æ­¥éª¤ï¼š**
1. ç™»å½•QQé‚®ç®±ç½‘é¡µç‰ˆ
2. è¿›å…¥"è®¾ç½®" â†’ "è´¦æˆ·"
3. å¼€å¯"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAVæœåŠ¡"
4. ç”Ÿæˆæˆæƒç ï¼ˆ16ä½å­—ç¬¦ï¼‰
5. å°†æˆæƒç å¡«å…¥ `SMTP_PASSWORD` å­—æ®µ

### æ•°æ®åº“æ¶æ„
- `users`: ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€å¯†ç å“ˆå¸Œã€éªŒè¯çŠ¶æ€
- `user_favorites`: ç”¨æˆ·æ”¶è—åŸå¸‚ï¼ˆå¤–é”®å…³è”ï¼‰
- `weather_cache`: å¤©æ°”æ•°æ®ç¼“å­˜ï¼ˆå¤–é”®å…³è”ï¼‰
- `email_verifications`: é‚®ç®±éªŒè¯ç ç®¡ç†ï¼ˆæ–°å¢ï¼‰âœ…
- `password_reset_tokens`: å¯†ç é‡ç½®ä»¤ç‰Œ
- `login_attempts`: ç™»å½•å°è¯•è®°å½•
- `cities`: åŸå¸‚ä¿¡æ¯ç®¡ç†

### æ–°å¢APIæ¥å£ âœ… **å·²å®ç°å¹¶æµ‹è¯•**
- `POST /api/auth/send-verification` - å‘é€é‚®ç®±éªŒè¯ç  âœ…
- `POST /api/auth/verify-code` - éªŒè¯é‚®ç®±éªŒè¯ç  âœ…
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œï¼ˆéœ€è¦éªŒè¯ç ï¼‰âœ…

### å‰ç«¯åŠŸèƒ½å¢å¼º âœ… **å·²å®ç°**
- **éªŒè¯ç å‘é€æŒ‰é’®**: å¸¦60ç§’å€’è®¡æ—¶ï¼Œé˜²æ­¢é‡å¤å‘é€ âœ…
- **éªŒè¯ç è¾“å…¥æ¡†**: 6ä½æ•°å­—éªŒè¯ï¼Œå®æ—¶æ ¼å¼éªŒè¯ âœ…
- **æˆåŠŸæç¤º**: éªŒè¯ç å‘é€æˆåŠŸåçš„å‹å¥½æç¤º âœ…
- **è¡¨å•éªŒè¯**: å®Œæ•´çš„è¡¨å•éªŒè¯é€»è¾‘ï¼ŒåŒ…æ‹¬éªŒè¯ç éªŒè¯ âœ…
- **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ç«¯å‹å¥½çš„éªŒè¯ç å‘é€æŒ‰é’®å¸ƒå±€ âœ…

### ğŸ¯ **åŠŸèƒ½æµ‹è¯•çŠ¶æ€**
- âœ… é‚®ç®±éªŒè¯ç å‘é€åŠŸèƒ½æ­£å¸¸
- âœ… ç”¨æˆ·æ³¨å†Œæµç¨‹å®Œæ•´
- âœ… å‰ç«¯éªŒè¯ç ç•Œé¢æ­£å¸¸
- âœ… åç«¯APIæ¥å£æ­£å¸¸
- âœ… æ•°æ®åº“è¡¨ç»“æ„å®Œæ•´
- âœ… SMTPé…ç½®æ­£ç¡®

### ğŸš€ **ä¸‹ä¸€æ­¥è®¡åˆ’**
- [ ] å¯†ç é‡ç½®åŠŸèƒ½ï¼ˆä½¿ç”¨é‚®ç®±éªŒè¯ï¼‰
- [ ] ç”¨æˆ·èµ„æ–™ç®¡ç†
- [ ] é‚®ç®±éªŒè¯ç é‡å‘ä¼˜åŒ–
- [ ] é‚®ä»¶æ¨¡æ¿ç¾åŒ–

### é—®é¢˜1ï¼špipä¾èµ–å†²çª

**é—®é¢˜æè¿°ï¼š**
```
ERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
mcp 1.9.1 requires anyio>=4.5, but you have anyio 3.7.1 which is incompatible.
mcp 1.9.1 requires pydantic<3.0.0,>=2.7.2, but you have pydantic 2.5.0 which is incompatible.
```

**é—®é¢˜åŸå› ï¼š**
- ç³»ç»ŸPythonç¯å¢ƒä¸­æœ‰å¤šä¸ªåŒ…ç‰ˆæœ¬å†²çª
- è™šæ‹Ÿç¯å¢ƒåˆ›å»ºæ—¶ç»§æ‰¿äº†ç³»ç»ŸåŒ…çš„ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# å‡çº§å†²çªçš„åŒ…åˆ°å…¼å®¹ç‰ˆæœ¬
pip install "anyio>=4.5"
pip install "pydantic>=2.7.2"
pip install "starlette>=0.41.3"
pip install "h11>=0.16.0"
```

**é¢„é˜²æªæ–½ï¼š**
- ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒéš”ç¦»é¡¹ç›®ä¾èµ–
- å®šæœŸæ›´æ–°requirements.txtæ–‡ä»¶
- é¿å…åœ¨ç³»ç»ŸPythonä¸­å®‰è£…è¿‡å¤šåŒ…

### é—®é¢˜2ï¼šPythonè·¯å¾„é…ç½®é”™è¯¯

**é—®é¢˜æè¿°ï¼š**
```
No Python at '"D:\python312\python.exe'
```

**é—®é¢˜åŸå› ï¼š**
- è™šæ‹Ÿç¯å¢ƒé…ç½®æŒ‡å‘äº†ä¸å­˜åœ¨çš„Pythonè·¯å¾„
- ç³»ç»Ÿä¸­æœ‰å¤šä¸ªPythonç‰ˆæœ¬ï¼Œè™šæ‹Ÿç¯å¢ƒæŒ‡å‘é”™è¯¯ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# åˆ é™¤æŸåçš„è™šæ‹Ÿç¯å¢ƒ
deactivate
Remove-Item -Path "backend\.venv" -Recurse -Force

# é‡æ–°åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
py -m venv backend\.venv
backend\.venv\Scripts\activate

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r backend/requirements.txt
```

### é—®é¢˜3ï¼šrequirements.txtç¼–ç é—®é¢˜

**é—®é¢˜æè¿°ï¼š**
```
UnicodeDecodeError: 'gbk' codec can't decode byte 0xae in position 27: illegal multibyte sequence
```

**é—®é¢˜åŸå› ï¼š**
- Windowsç³»ç»Ÿé»˜è®¤ä½¿ç”¨GBKç¼–ç è¯»å–æ–‡ä»¶
- requirements.txtæ–‡ä»¶åŒ…å«ä¸­æ–‡å­—ç¬¦
- pipæ— æ³•æ­£ç¡®è§£ææ–‡ä»¶å†…å®¹

**è§£å†³æ–¹æ¡ˆï¼š**
- å°†requirements.txtä¸­çš„ä¸­æ–‡æ³¨é‡Šæ”¹ä¸ºè‹±æ–‡
- ä½¿ç”¨UTF-8ç¼–ç ä¿å­˜æ–‡ä»¶
- é¿å…åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦

**ä¿®å¤åçš„requirements.txtï¼š**
```txt
# Core framework - compatible versions
fastapi>=0.104.0,<0.112.0
uvicorn[standard]>=0.24.0,<0.31.0
httpx>=0.25.0,<0.28.0
# ... å…¶ä»–ä¾èµ–
```

### é—®é¢˜4ï¼šJWTæ¨¡å—å¯¼å…¥é”™è¯¯

**é—®é¢˜æè¿°ï¼š**
```
ModuleNotFoundError: No module named 'jwt'
```

**é—®é¢˜åŸå› ï¼š**
- ä»£ç ä¸­ä½¿ç”¨äº† `import jwt`
- ä½†åº”è¯¥ä½¿ç”¨ `python-jose` åŒ…æä¾›çš„JWTåŠŸèƒ½

**è§£å†³æ–¹æ¡ˆï¼š**
```python
# ä¿®å¤å‰
import jwt

# ä¿®å¤å
from jose import jwt, JWTError

# åŒæ—¶ä¿®å¤å¼‚å¸¸å¤„ç†
# ä¿®å¤å‰
except jwt.PyJWTError:
# ä¿®å¤å
except JWTError:
```

**éœ€è¦ä¿®å¤çš„æ–‡ä»¶ï¼š**
- `backend/app/routers/auth.py`
- `backend/app/services/user_service.py`

### é—®é¢˜5ï¼špydantic-settingsæ¨¡å—ç¼ºå¤±

**é—®é¢˜æè¿°ï¼š**
```
ModuleNotFoundError: No module named 'pydantic_settings'
```

**é—®é¢˜åŸå› ï¼š**
- ç¼ºå°‘ `pydantic-settings` åŒ…
- æˆ–è€…ç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# å®‰è£…pydantic-settings
pip install pydantic-settings

# æˆ–è€…ä½¿ç”¨å…¼å®¹çš„å¯¼å…¥æ–¹å¼
from pydantic import BaseSettings  # å¯¹äºpydantic v2
```

### é—®é¢˜6ï¼šæ•°æ®åº“è¿æ¥é…ç½®é—®é¢˜

**é—®é¢˜æè¿°ï¼š**
```
ERROR:app.database.connection:Database initialization error: (asyncmy.errors.OperationalError) (1045, "Access denied for user 'root'@'localhost' (using password: YES)")
```

**é—®é¢˜åŸå› ï¼š**
- MySQLç”¨æˆ·å¯†ç é…ç½®é”™è¯¯
- è®¤è¯æ’ä»¶ä¸å…¼å®¹ï¼ˆcaching_sha2_password vs mysql_native_passwordï¼‰

**è§£å†³æ–¹æ¡ˆï¼š**
```sql
-- åˆ›å»ºæ–°ç”¨æˆ·ï¼Œä½¿ç”¨å…¼å®¹çš„è®¤è¯æ–¹å¼
CREATE USER 'weatheruser'@'localhost' IDENTIFIED BY 'weatherpass123';
GRANT ALL PRIVILEGES ON weatherwhisper.* TO 'weatheruser'@'localhost';
GRANT ALL PRIVILEGES ON weatherwhisper.* TO 'weatheruser'@'127.0.0.1';
FLUSH PRIVILEGES;
```

**æ›´æ–°.envæ–‡ä»¶ï¼š**
```bash
DATABASE_URL=mysql+asyncmy://weatheruser:weatherpass123@localhost:3306/weatherwhisper
```

### é—®é¢˜7ï¼šç¼ºå¤±çš„æ•°æ®åº“æ¨¡å‹æ–‡ä»¶

**é—®é¢˜æè¿°ï¼š**
```
ModuleNotFoundError: No module named 'app.schemas.user'
```

**é—®é¢˜åŸå› ï¼š**
- é¡¹ç›®æ¶æ„éœ€è¦ç‰¹å®šçš„æ•°æ®æ¨¡å‹æ–‡ä»¶
- è¿™äº›æ–‡ä»¶åœ¨é¡¹ç›®è¿ç§»è¿‡ç¨‹ä¸­ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆï¼š**
åˆ›å»ºç¼ºå¤±çš„æ¨¡å—æ–‡ä»¶ï¼š
- `backend/app/schemas/user.py` - ç”¨æˆ·æ•°æ®æ¨¡å‹
- `backend/app/schemas/city.py` - åŸå¸‚æ•°æ®æ¨¡å‹  
- `backend/app/schemas/weather.py` - å¤©æ°”æ•°æ®æ¨¡å‹

### é—®é¢˜8ï¼šç¯å¢ƒå˜é‡é…ç½®ä¼˜å…ˆçº§

**é—®é¢˜æè¿°ï¼š**
- ä¿®æ”¹äº† `config.py` ä¸­çš„é»˜è®¤å€¼
- ä½† `.env` æ–‡ä»¶ä¸­çš„é…ç½®ä»ç„¶è¦†ç›–äº†é»˜è®¤å€¼

**é—®é¢˜åŸå› ï¼š**
- `.env` æ–‡ä»¶çš„é…ç½®ä¼˜å…ˆçº§é«˜äºä»£ç ä¸­çš„é»˜è®¤å€¼
- éœ€è¦åŒæ—¶æ›´æ–°ä¸¤ä¸ªåœ°æ–¹çš„é…ç½®

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ›´æ–° `.env` æ–‡ä»¶ä¸­çš„é…ç½®
2. ç¡®ä¿ `config.py` ä¸­çš„é»˜è®¤å€¼ä¹Ÿæ˜¯æ­£ç¡®çš„
3. ä½¿ç”¨ç¯å¢ƒå˜é‡è¦†ç›–é»˜è®¤å€¼

## ğŸ¯ æˆåŠŸå¯åŠ¨æ£€æŸ¥æ¸…å•

### åç«¯å¯åŠ¨æ£€æŸ¥
- [x] è™šæ‹Ÿç¯å¢ƒæ¿€æ´»
- [x] ä¾èµ–åŒ…å®‰è£…å®Œæˆ
- [x] æ•°æ®åº“è¿æ¥æˆåŠŸ
- [x] æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
- [x] FastAPIæœåŠ¡å¯åŠ¨æˆåŠŸ
- [x] ç«¯å£8000ç›‘å¬æ­£å¸¸
- [x] è®¤è¯APIæ¥å£æ­£å¸¸
- [x] JWTä»¤ç‰Œç”ŸæˆéªŒè¯æ­£å¸¸

### å‰ç«¯å¯åŠ¨æ£€æŸ¥
- [x] Node.jsç¯å¢ƒæ­£å¸¸
- [x] ä¾èµ–åŒ…å®‰è£…å®Œæˆ
- [x] å¼€å‘æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
- [x] ç«¯å£3000ç›‘å¬æ­£å¸¸
- [x] ä»£ç†é…ç½®æ­£ç¡®
- [x] ç™»å½•æ³¨å†Œé¡µé¢æ­£å¸¸
- [x] è·¯ç”±å®ˆå«æ­£å¸¸å·¥ä½œ

### æ•°æ®åº“é…ç½®æ£€æŸ¥
- [x] MySQLæœåŠ¡è¿è¡Œæ­£å¸¸
- [x] æ•°æ®åº“ç”¨æˆ·æƒé™æ­£ç¡®
- [x] æ•°æ®åº“è¡¨ç»“æ„å®Œæ•´
- [x] è¿æ¥å­—ç¬¦ä¸²æ ¼å¼æ­£ç¡®
- [x] å¤–é”®çº¦æŸé…ç½®æ­£ç¡®
- [x] çº§è”åˆ é™¤è§„åˆ™æ­£å¸¸

### è®¤è¯åŠŸèƒ½æ£€æŸ¥
- [x] ç”¨æˆ·æ³¨å†Œæµç¨‹æ­£å¸¸
- [x] ç”¨æˆ·ç™»å½•æµç¨‹æ­£å¸¸
- [x] JWTä»¤ç‰Œç”Ÿæˆæ­£å¸¸
- [x] è®¿å®¢æ¨¡å¼è®¿é—®æ­£å¸¸
- [x] è·¯ç”±æƒé™æ§åˆ¶æ­£å¸¸

## ğŸ’¡ ç»éªŒæ€»ç»“

1. **ç¯å¢ƒéš”ç¦»å¾ˆé‡è¦**ï¼šä½¿ç”¨è™šæ‹Ÿç¯å¢ƒé¿å…ç³»ç»ŸåŒ…å†²çª
2. **é…ç½®æ–‡ä»¶è¦åŒæ­¥**ï¼šä»£ç é»˜è®¤å€¼å’Œç¯å¢ƒå˜é‡è¦ä¿æŒä¸€è‡´
3. **ä¾èµ–ç‰ˆæœ¬è¦å…¼å®¹**ï¼šæ³¨æ„åŒ…ä¹‹é—´çš„ç‰ˆæœ¬å…¼å®¹æ€§
4. **é”™è¯¯ä¿¡æ¯è¦ä»”ç»†çœ‹**ï¼šå¾ˆå¤šé—®é¢˜éƒ½æœ‰æ˜ç¡®çš„é”™è¯¯æç¤º
5. **åˆ†æ­¥éª¤è§£å†³é—®é¢˜**ï¼šä¸€æ¬¡è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œé¿å…åŒæ—¶ä¿®æ”¹å¤šä¸ªåœ°æ–¹
6. **æ•°æ®åº“å¤–é”®è®¾è®¡**ï¼šåˆç†è®¾è®¡å¤–é”®çº¦æŸï¼Œä½¿ç”¨çº§è”åˆ é™¤é¿å…æ•°æ®ä¸ä¸€è‡´
7. **ORMæ¨¡å‹åŒæ­¥**ï¼šç¡®ä¿SQLAlchemyæ¨¡å‹ä¸æ•°æ®åº“è¡¨ç»“æ„å®Œå…¨åŒ¹é…
8. **è®¤è¯æµç¨‹è®¾è®¡**ï¼šJWTä»¤ç‰Œè¿‡æœŸæ—¶é—´è¦åˆç†ï¼Œå‰ç«¯å­˜å‚¨è¦å®‰å…¨
9. **é”™è¯¯å¤„ç†æœºåˆ¶**ï¼šå‹å¥½çš„é”™è¯¯æç¤ºå’Œå¼‚å¸¸å¤„ç†æå‡ç”¨æˆ·ä½“éªŒ
10. **ä»£ç æ¶æ„æ¸…æ™°**ï¼šå‰åç«¯åˆ†ç¦»ï¼Œæ¨¡å—åŒ–è®¾è®¡ä¾¿äºç»´æŠ¤å’Œæ‰©å±•

## ğŸ”§ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# è™šæ‹Ÿç¯å¢ƒç®¡ç†
backend\.venv\Scripts\activate          # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
deactivate                              # é€€å‡ºè™šæ‹Ÿç¯å¢ƒ

# ä¾èµ–ç®¡ç†
pip install -r backend/requirements.txt # å®‰è£…ä¾èµ–
pip list | findstr package_name         # æŸ¥çœ‹åŒ…ç‰ˆæœ¬

# æœåŠ¡å¯åŠ¨
python -m uvicorn app.main:app --app-dir backend --host 127.0.0.1 --port 8000 --reload  # å¯åŠ¨åç«¯
cd frontend
npm run dev               # å¯åŠ¨å‰ç«¯ï¼ˆç«¯å£3000ï¼‰

# æ•°æ®åº“ç®¡ç†
python backend/init_auth_tables.py      # åˆå§‹åŒ–è®¤è¯è¡¨
python backend/check_database.py        # æ£€æŸ¥æ•°æ®åº“ç»“æ„
mysql -u weatheruser -p                 # è¿æ¥æ•°æ®åº“

# è®¤è¯æµ‹è¯•
# å‰ç«¯è®¿é—®: http://localhost:3000/login
# åç«¯API: http://127.0.0.1:8000/docs

# ç¼“å­˜æ¸…ç†
Remove-Item -Path "__pycache__" -Recurse -Force  # æ¸…ç†Pythonç¼“å­˜
```

## âœ‰ï¸ é‚®ä»¶æ¨é€å¤©æ°”ï¼ˆ2025-08-19ï¼‰

> æœ¬èŠ‚è¯´æ˜æ–°åŠ å…¥çš„"é‚®ä»¶æ¨é€å¤©æ°”ï¼ˆç«‹å³/å®šæ—¶ï¼‰"åŠŸèƒ½ã€æŠ€æœ¯å®ç°ã€ä½¿ç”¨è¯´æ˜ã€æ•°æ®åº“å˜æ›´ä¸å¸¸è§é—®é¢˜ã€‚

### åŠŸèƒ½æ¦‚è§ˆ
- **ç«‹å³å‘é€**
  - åœ¨"å½“å‰å¤©æ°”"ä¸"å·²å…³æ³¨çš„åŸå¸‚"å¤„æ–°å¢"å‘é€åˆ°é‚®ç®±"æŒ‰é’®
  - å¼¹çª—æ”¯æŒé€‰æ‹©åŸå¸‚ã€é‚®ç®±ï¼ˆé»˜è®¤ç™»å½•é‚®ç®±ï¼Œå¯æ”¹ï¼‰ã€å®æ—¶é¢„è§ˆ"ä»Šæ—¥å¤©æ°”æ‘˜è¦"åå‘é€
  - å‘é€æˆåŠŸ/å¤±è´¥ï¼Œå¼¹çª—å³ä¸Šè§’ toast æç¤ºï¼ˆæˆåŠŸ 1.2 ç§’åè‡ªåŠ¨å…³é—­ï¼‰
- **å®šæ—¶å‘é€**
  - é¢‘ç‡ï¼šä¸€æ¬¡ / æ¯å¤©
  - é»˜è®¤å€¼ï¼šåˆ‡æ¢åˆ°"å®šæ—¶"æ—¶ï¼Œé¢‘ç‡é»˜è®¤"ä¸€æ¬¡"ï¼Œæ—¶é—´=å½“å‰æ—¶åˆ»ï¼Œæ—¥æœŸ=ä»Šå¤©ï¼ˆAsia/Shanghaiï¼‰
  - åˆ›å»ºæˆåŠŸåç”±åå°è°ƒåº¦å™¨è‡ªåŠ¨åœ¨åˆ°ç‚¹æ‰§è¡Œ

### æŠ€æœ¯å®ç°
- **åç«¯**
  - FastAPI + SQLAlchemy Asyncï¼ˆMySQL / asyncmyï¼‰
  - é‚®ä»¶å‘é€ï¼š`emails` åº“ï¼ˆQQ SMTPï¼‰
  - å¤©æ°”æ•°æ®ï¼šå’Œé£å¤©æ°” APIï¼ˆå®æ—¶ + 7 å¤©ï¼‰ï¼›é¢„è§ˆæ–‡æ¡ˆç”±æœåŠ¡å±‚ç»„åˆï¼ˆ"ä»Šæ—¥å®æ—¶ + ä»Šæ—¥é«˜ä½æ¸©"ï¼‰
  - è½»é‡è°ƒåº¦å™¨ï¼š`EmailScheduleWorker`ï¼ˆåå°å¼‚æ­¥å¾ªç¯ï¼Œæ¯ 60 ç§’æ‰«æä¸€æ¬¡ï¼‰
    - åˆ°æœŸä»»åŠ¡æ‰§è¡Œå‘é€ï¼›ONCE æˆåŠŸåç½® `SENT`ï¼›DAILY æˆåŠŸå `next_run_at += 1 day`
    - å¤±è´¥ä»»åŠ¡å›é€€ 5 åˆ†é’Ÿåé‡è¯•ï¼Œé¿å…çƒ­å¾ªç¯
  - é€šçŸ¥è·¯ç”±ï¼šä¼˜å…ˆæ”¯æŒ `city_name + province` å…¥å‚ï¼›æœåŠ¡å†…è‡ªåŠ¨è§£æå’Œé£ `location id`
- **å‰ç«¯**
  - å¼¹çª— `SendWeatherEmailModal`ï¼šåŸå¸‚ä¸‹æ‹‰ã€é‚®ç®±ã€å‘é€æ–¹å¼ï¼ˆç«‹å³/å®šæ—¶ï¼‰ã€é¢‘ç‡/æ—¶é—´/æ—¥æœŸã€é¢„è§ˆåŒºã€loading ä¸ toast
  - API å°è£… `useNotificationApi`ï¼š`previewWeatherEmail / sendWeatherEmail / scheduleWeatherEmail`
  - æ”¶è—ç‚¹å‡»åé€šè¿‡"çœä»½+åŸå¸‚å"è§£æå‡ºå’Œé£åŸå¸‚ ID å†æŸ¥è¯¢å¤©æ°”ï¼Œé¿å… ID ç¼ºå¤±

### æ•°æ®åº“å­˜å‚¨
- `email_notifications`ï¼šå‘é€æ—¥å¿—
  - å…³é”®å­—æ®µï¼š`user_id, email, city_id, subject, content, status(SENT/FAILED), error_message, created_at`
- `email_schedules`ï¼šå®šæ—¶ä»»åŠ¡
  - å…³é”®å­—æ®µï¼š`user_id, email, city_id, city_name, province, type(ONCE|DAILY), time_hhmm, date, timezone, next_run_at(UTC), status(ACTIVE/CANCELLED/SENT), last_run_at, created_at`
  - å¦‚éœ€æ‰‹å·¥è¿ç§»ï¼ˆå·²åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼‰ï¼š
    ```sql
    ALTER TABLE email_schedules ADD COLUMN IF NOT EXISTS city_name VARCHAR(100) NULL;
    ALTER TABLE email_schedules ADD COLUMN IF NOT EXISTS province  VARCHAR(100) NULL;
    ```

### ä½¿ç”¨è¯´æ˜
- **ç«‹å³å‘é€**
  1. ç‚¹å‡»"å‘é€åˆ°é‚®ç®±"æ‰“å¼€å¼¹çª—ï¼Œç¡®è®¤åŸå¸‚ä¸é‚®ç®±
  2. é¢„è§ˆåŒºå±•ç¤º"ä»Šæ—¥å¤©æ°”æ‘˜è¦"ï¼Œç‚¹å‡»"å‘é€"
  3. å¼¹çª—å³ä¸Šè§’æ˜¾ç¤ºç»“æœï¼›æˆåŠŸ 1.2 ç§’åè‡ªåŠ¨å…³é—­
  4. å¯åœ¨ `email_notifications` è¡¨æŸ¥çœ‹å†å²è®°å½•
- **åˆ›å»ºå®šæ—¶**
  1. åˆ‡æ¢"å®šæ—¶"ï¼Œè®¾ç½®"é¢‘ç‡/æ—¶é—´/æ—¥æœŸ"ï¼ˆé»˜è®¤å·²å¡«å¥½ï¼‰
  2. ç‚¹å‡»"åˆ›å»ºå®šæ—¶"ï¼ŒæˆåŠŸåç”±åå°æ¯ 60 ç§’æ‰«æï¼Œåˆ°ç‚¹è‡ªåŠ¨å‘é€
  3. ONCE æ‰§è¡ŒæˆåŠŸåä»»åŠ¡æ ‡è®°ä¸º `SENT`ï¼›DAILY æ‰§è¡ŒæˆåŠŸå `next_run_at += 1 å¤©`

### è°ƒåº¦å™¨ä¸èµ„æºå ç”¨
- è½®è¯¢å‘¨æœŸï¼šé»˜è®¤ 60 ç§’ï¼ˆå¯è°ƒï¼‰
- æ¯æ¬¡å¤„ç†ï¼šæœ€å¤š 20 æ¡ï¼ˆå¯è°ƒï¼‰
- å¤±è´¥å›é€€ï¼š5 åˆ†é’Ÿåå†è¯•
- è¯´æ˜ï¼šæ‰«ææŸ¥è¯¢ä¸ºè½»é‡ SQLï¼Œæ‰¹é‡å°ã€å‘é€ä¸²è¡Œï¼Œå¼€é”€å¯æ§ï¼›å¦‚éœ€æ›´é«˜æ€§èƒ½å¯æŒ‰éœ€å¼€å¯å¹¶å‘å‘é€æˆ–ç¼©çŸ­è½®è¯¢é—´éš”

### é…ç½®é¡¹ï¼ˆåç«¯ï¼‰
- è°ƒåº¦å™¨ï¼ˆ`app/main.py`ï¼‰
  - `EmailScheduleWorker(AsyncSessionLocal, interval_seconds=60, batch_size=20)`
- å‘é€é™æµï¼ˆ`notification_service.py`ï¼‰
  - `MIN_INTERVAL_SECONDS`ï¼šæœ€å°é—´éš”ç§’æ•°ï¼ˆé’ˆå¯¹ user+emailï¼‰
  - `DAILY_QUOTA`ï¼šæ¯æ—¥é…é¢
  - `RATE_LIMIT_ENABLED`ï¼šé™æµæ€»å¼€å…³ï¼ˆå¼€å‘/è”è°ƒå¯å…³é—­ï¼‰

### å¸¸è§é—®é¢˜ & è§£å†³æ–¹æ¡ˆ
- å¯åŠ¨æ—¶æŠ¥ ORM å…³ç³»é”™è¯¯ï¼ˆåˆ é™¤ `city_id` åï¼‰
  - æ–¹æ¡ˆï¼š`City.favorites` æ”¹ä¸ºåç§°+çœä»½çš„ `primaryjoin`ï¼ˆ`viewonly=True`ï¼‰ï¼Œä¸å†ä¾èµ–å¤–é”®
- ç«‹å³å‘é€ 422/500
  - åŸå› ï¼šå‰ç«¯ä¼  `city_id` æˆ–åç«¯æœªè§£æ ID
  - æ–¹æ¡ˆï¼šç»Ÿä¸€ä½¿ç”¨ `city_name + province`ï¼Œåç«¯ `search_city(query)` è§£æå’Œé£ `location id`
- é¢‘ç¹é™åˆ¶è¯¯åˆ¤ï¼ˆ429ï¼‰
  - æ–¹æ¡ˆï¼šåªç»Ÿè®¡ `SENT` è®°å½•ï¼›åˆ¤å®šç»´åº¦ä¸º `(user_id, email)`ï¼›æ”¯æŒæ€»å¼€å…³ `RATE_LIMIT_ENABLED`
- å®šæ—¶æŠ¥ 500ï¼š`Unknown column 'city_name' in 'field list'`
  - æ–¹æ¡ˆï¼šè¡¥é½ `email_schedules.city_name/province` ä¸¤åˆ—ï¼ˆè§ä¸Šæ–‡ SQLï¼‰
- æ”¶è—ç‚¹å‡»åå¤©æ°”é¡µé¢ç©ºç™½/Invalid Date
  - æ–¹æ¡ˆï¼šç‚¹å‡»æ”¶è—æ—¶ç”¨"çœä»½+åŸå¸‚å"é‡æ–°æœç´¢è·å–å¸¦ `id` çš„åŸå¸‚å¯¹è±¡ï¼Œå†æ‹‰å–å¤©æ°”

## ğŸ¤– RAG æ™ºèƒ½ç©¿è¡£å»ºè®®ï¼ˆ2025-08-21ï¼‰

> æœ¬èŠ‚è¯´æ˜åŸºäº RAG (Retrieval-Augmented Generation) + Gemini AI å®ç°çš„æ™ºèƒ½ç©¿è¡£å»ºè®®åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›ä¸ªæ€§åŒ–çš„ç©¿æ­æ¨èã€‚

### åŠŸèƒ½æ¦‚è§ˆ
- **AIç©¿è¡£å»ºè®®**
  - åŸºäºå®æ—¶å¤©æ°”æ•°æ®ï¼ˆæ¸©åº¦ã€æ¹¿åº¦ã€é£åŠ›ã€å¤©æ°”çŠ¶å†µï¼‰ç”Ÿæˆä¸ªæ€§åŒ–ç©¿æ­å»ºè®®
  - é›†æˆåœ¨é‚®ä»¶é¢„è§ˆ/å‘é€åŠŸèƒ½ä¸­ï¼Œè‡ªåŠ¨é™„åŠ åœ¨å¤©æ°”ä¿¡æ¯å
  - æ”¯æŒä¸åŒå¤©æ°”æ¡ä»¶çš„ä¸“ä¸šç©¿æ­æŒ‡å¯¼ï¼ˆæ™´å¤©ã€é›¨å¤©ã€å¤§é£ç­‰ï¼‰
  - è€ƒè™‘æ¸©å·®å˜åŒ–ï¼Œæä¾›å…¨å¤©å€™ç©¿è¡£æ–¹æ¡ˆ

### æŠ€æœ¯æ¶æ„

#### **RAG æ£€ç´¢å¢å¼ºç”Ÿæˆ**
```
ç”¨æˆ·è¯·æ±‚ â†’ å¤©æ°”æ•°æ®æå– â†’ è¯­ä¹‰æŸ¥è¯¢æ„å»º â†’ å‘é‡æ£€ç´¢ â†’ LLMç”Ÿæˆ â†’ ç©¿è¡£å»ºè®®
```

#### **æŠ€æœ¯æ ˆ**
- **å‘é‡æ•°æ®åº“**: Pineconeï¼ˆäº‘ç«¯æ‰˜ç®¡ï¼Œæ¯«ç§’çº§æ£€ç´¢ï¼‰
- **åµŒå…¥æ¨¡å‹**: BAAI/bge-base-zh-v1.5ï¼ˆ768ç»´ä¸­æ–‡è¯­ä¹‰å‘é‡ï¼‰
- **ç”Ÿæˆæ¨¡å‹**: Google Gemini 1.5 Flashï¼ˆå¿«é€Ÿå“åº”ï¼Œæˆæœ¬ä¼˜åŒ–ï¼‰
- **çŸ¥è¯†åº“**: ä¸“ä¸šæ—¶å°šç©¿æ­çŸ¥è¯†ï¼ˆExcelâ†’å‘é‡åŒ–å­˜å‚¨ï¼‰

#### **å…³é”®ç»„ä»¶**
- `rag_service.py`: RAGæ ¸å¿ƒæœåŠ¡ï¼ˆæ£€ç´¢+ç”Ÿæˆï¼‰
- `notification_service.py`: é‚®ä»¶æœåŠ¡é›†æˆRAG
- `ingest_pinecone.py`: çŸ¥è¯†åº“å‘é‡åŒ–è„šæœ¬
- `knowledge_base.xlsx`: ç©¿æ­çŸ¥è¯†åº“ï¼ˆå¯ç¼–è¾‘ï¼‰

### å®ç°æµç¨‹

#### **1. å¤©æ°”æ•°æ®ç»„ç»‡**
```python
weather_info = {
    "city_name": "å¹¿å·",
    "condition": "å¤šäº‘",        # å¤©æ°”çŠ¶å†µ
    "temp": "28",             # å½“å‰æ¸©åº¦
    "feels_like": "30",       # ä½“æ„Ÿæ¸©åº¦
    "humidity": "75",         # æ¹¿åº¦
    "wind_dir": "ä¸œå—é£",      # é£å‘
    "wind_scale": "2",        # é£åŠ›ç­‰çº§
    "temp_max": "32",         # ä»Šæ—¥æœ€é«˜æ¸©
    "temp_min": "26"          # ä»Šæ—¥æœ€ä½æ¸©
}
```

#### **2. è¯­ä¹‰æŸ¥è¯¢æ„å»º**
```python
def build_query_from_weather(info):
    parts = []
    if info.get("condition"):
        parts.append(f"å¤©æ°”{info['condition']}")
    if info.get("feels_like"):
        parts.append(f"ä½“æ„Ÿæ¸©åº¦{info['feels_like']}åº¦")
    if info.get("humidity"):
        parts.append(f"æ¹¿åº¦{info['humidity']}%")
    return "ï¼Œ".join(parts)  # "å¤©æ°”å¤šäº‘ï¼Œä½“æ„Ÿæ¸©åº¦30åº¦ï¼Œæ¹¿åº¦75%"
```

#### **3. å‘é‡æ£€ç´¢åŒ¹é…**
```python
def retrieve_rag_context(query, top_k=4):
    embedder = _get_embedder()  # bge-base-zh-v1.5
    index = _get_index()        # Pineconeç´¢å¼•
    vec = embedder.encode(query, normalize_embeddings=True).tolist()
    res = index.query(vector=vec, top_k=top_k, include_metadata=True)
    return "\n".join([m["metadata"]["text"] for m in res["matches"]])
```

#### **4. Gemini ç”Ÿæˆå»ºè®®**
```python
def generate_advice(weather_info, rag_context):
    model = genai.GenerativeModel('gemini-1.5-flash')
    prompt = f"""
    ä½ æ˜¯ä¸“ä¸šç©¿æ­é¡¾é—®ã€‚åŸºäºä»¥ä¸‹çŸ¥è¯†åº“ä¸å¤©æ°”ä¿¡æ¯ï¼Œç”Ÿæˆç©¿è¡£å»ºè®®ï¼š
    
    [çŸ¥è¯†åº“å‚è€ƒ]
    {rag_context}
    
    [å¤©æ°”ä¿¡æ¯]
    åŸå¸‚ï¼š{weather_info['city_name']}
    å½“å‰æ¸©åº¦ï¼š{weather_info['temp']}Â°C
    ä½“æ„Ÿæ¸©åº¦ï¼š{weather_info['feels_like']}Â°C
    ...
    
    [è¦æ±‚]
    - 4æ¡è¦ç‚¹ï¼Œæ¯æ¡ä¸è¶…è¿‡40å­—
    - è€ƒè™‘æ¸©å·®å˜åŒ–å’Œç‰¹æ®Šå¤©æ°”
    - è¯­æ°”ä¸“ä¸šæ¸©å’Œ
    """
    return model.generate_content(prompt).text
```

### é›†æˆä¸è°ƒç”¨

#### **é‚®ä»¶é¢„è§ˆé›†æˆ**
é‚®ä»¶é¢„è§ˆ/å‘é€æ—¶è‡ªåŠ¨è°ƒç”¨RAGæœåŠ¡ï¼š


#### **ç‹¬ç«‹APIæ¥å£**
```python
# routers/rag.py
@router.get("/fashion-advice")
async def fashion_advice(city_id: str, city_name: str):
    # å®Œæ•´çš„RAGæµç¨‹ï¼Œè¿”å›è¯¦ç»†ä¿¡æ¯
    return {
        "weather": weather_info,
        "query": query,
        "rag_context": rag_context,
        "advice": advice
    }
```

### å‰ç«¯ä½“éªŒä¼˜åŒ–

#### **è¶…æ—¶ä¸é™çº§**
- **å…¨å±€è¶…æ—¶**: 30ç§’ (axios)
- **é€šçŸ¥æ¥å£**: 45ç§’ (RAG+ç”Ÿæˆè€—æ—¶)
- **é™çº§ç­–ç•¥**: RAGå¤±è´¥æ—¶è¿”å›åŸºç¡€å¤©æ°”ä¿¡æ¯

#### **ç”¨æˆ·äº¤äº’**
- æ¯ä¸ªæ”¶è—åŸå¸‚å¡ç‰‡éƒ½æœ‰ç‹¬ç«‹çš„"âœ‰ï¸"æŒ‰é’®
- ç‚¹å‡»åå¼¹çª—è‡ªåŠ¨é€‰ä¸­å¯¹åº”åŸå¸‚
- é¢„è§ˆåŒºæ˜¾ç¤ºå®Œæ•´çš„"å¤©æ°”+ç©¿è¡£å»ºè®®"
- ç”Ÿæˆè¿‡ç¨‹ä¸­æ˜¾ç¤º"ç”Ÿæˆé¢„è§ˆä¸­â€¦"çŠ¶æ€

### çŸ¥è¯†åº“ç®¡ç†

#### **Excel æ ¼å¼**
```
| id | category | suggestion |
|----|----------|------------|
| 1  | é«˜æ¸©     | é€‰æ‹©è½»è–„é€æ°”çš„æ£‰è´¨Tæ¤ï¼Œé¿å…æ·±è‰²è¡£ç‰©... |
| 2  | é™é›¨     | å‡†å¤‡é˜²æ°´å¤–å¥—å’Œé›¨ä¼ï¼Œé€‰æ‹©å¿«å¹²æè´¨... |
```

#### **å‘é‡åŒ–å…¥åº“**
```bash
# æ‰§è¡Œå‘é‡åŒ–è„šæœ¬
python backend/rag/ingest_pinecone.py

# è¾“å‡ºç¤ºä¾‹
æ­£åœ¨åˆå§‹åŒ–Pinecone...
æ­£åœ¨åŠ è½½Embeddingæ¨¡å‹...
è¯»å–çŸ¥è¯†åº“æ–‡ä»¶: knowledge_base.xlsx
æ­£åœ¨ç”Ÿæˆå‘é‡...
å‡†å¤‡ä¸Šä¼  150 æ¡å‘é‡åˆ°Pinecone...
æ•°æ®å…¥åº“å®Œæˆï¼
```

### ç¯å¢ƒé…ç½®

#### **å¿…éœ€ç¯å¢ƒå˜é‡**
```bash
# .env æ–‡ä»¶
PINECONE_API_KEY=your_pinecone_key
GEMINI_API_KEY=your_gemini_key
GEMINI_MODEL=gemini-1.5-flash  # å¯é€‰ï¼Œé»˜è®¤flash
```

#### **ä¾èµ–å®‰è£…**
```bash
# åç«¯æ–°å¢ä¾èµ–
pip install sentence-transformers pinecone-client google-generativeai
```

### æ€§èƒ½ä¸æˆæœ¬

#### **å“åº”æ—¶é—´**
- **å‘é‡æ£€ç´¢**: <100ms (Pinecone)
- **è¯­ä¹‰ç¼–ç **: 200-500ms (æœ¬åœ°æ¨¡å‹)
- **æ–‡æœ¬ç”Ÿæˆ**: 1-3ç§’ (Gemini Flash)
- **æ€»è€—æ—¶**: é€šå¸¸2-5ç§’

#### **æˆæœ¬ä¼˜åŒ–**
- **æ¨¡å‹é€‰æ‹©**: Gemini 1.5 Flash (æˆæœ¬æ˜¯Proçš„1/20)
- **æ£€ç´¢ç¼“å­˜**: ç›¸åŒæŸ¥è¯¢å¤ç”¨ç»“æœ
- **é™çº§æœºåˆ¶**: AIå¤±è´¥æ—¶ä»æœ‰åŸºç¡€åŠŸèƒ½

### æ‰©å±•æ–¹å‘

#### **çŸ¥è¯†åº“å¢å¼º**
- [ ] å­£èŠ‚æ€§ç©¿æ­çŸ¥è¯†
- [ ] ä¸åŒèŒä¸šåœºæ™¯ç©¿æ­
- [ ] åœ°åŸŸæ–‡åŒ–å·®å¼‚è€ƒè™‘
- [ ] ç”¨æˆ·ä¸ªäººåå¥½å­¦ä¹ 

#### **åŠŸèƒ½æ‰©å±•**
- [ ] ç©¿æ­å›¾ç‰‡æ¨è
- [ ] æœè£…æ­é…è‰²å½©å»ºè®®
- [ ] è´­ç‰©æ¸…å•ç”Ÿæˆ
- [ ] å†å²ç©¿æ­è®°å½•

---

> å¦‚éœ€æŠŠè°ƒåº¦é¢‘ç‡/å‘é€å¹¶å‘è¿›ä¸€æ­¥å‚æ•°åŒ–æˆ–å¢åŠ "ä»»åŠ¡åˆ—è¡¨/å–æ¶ˆä»»åŠ¡"æ¥å£ï¼Œå¯åœ¨ `routers/notifications.py` ä¸ `services/scheduler.py` åŸºç¡€ä¸Šæ‰©å±•ã€‚

```
